<!DOCTYPE html>
<html>
<head>
    <title>OAuth Callback</title>
    <script>
        window.onload = function() {
            console.log("Callback page loaded");
            // Parse the URL fragment (everything after #)
            const hash = window.location.hash.substring(1);
            console.log("URL hash:", hash);
            
            // Extract the access token
            const params = new URLSearchParams(hash);
            const accessToken = params.get('access_token');
            console.log("Access token:", accessToken);
            
            if (accessToken) {
                // Try sending the token to the opener window
                if (window.opener) {
                    console.log("Sending token to opener");
                    window.opener.postMessage({ access_token: accessToken }, "*");
                    
                    // Add a visual confirmation
                    document.getElementById("status").innerText = "Token sent! You can close this window.";
                } else {
                    console.error("No opener window found");
                    document.getElementById("status").innerText = "Error: Could not communicate with plugin.";
                }
            } else {
                console.error("No access token found in URL");
                document.getElementById("status").innerText = "No token found in URL.";
            }
        };
    </script>
</head>
<body>
    <h2>Authentication Complete</h2>
    <p id="status">Processing authentication...</p>
    <p>You can close this window and return to the plugin.</p>
</body>
</html>